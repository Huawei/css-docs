<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>升级华为CSI on Huawei</title>
    <link>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/</link>
    <description>Recent content in 升级华为CSI on Huawei</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <atom:link href="/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>从2.x或3.x升级至4.x版本</title>
      <link>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/%E4%BB%8E2-x%E6%88%963-x%E5%8D%87%E7%BA%A7%E8%87%B34-x%E7%89%88%E6%9C%AC/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/%E4%BB%8E2-x%E6%88%963-x%E5%8D%87%E7%BA%A7%E8%87%B34-x%E7%89%88%E6%9C%AC/</guid>
      <description>在CSI 2.x或3.x 版本中，使用块存储时，与存储建立映射的操作是在huawei-csi-node服务进行的，所以huawei-csi-node服务需要和存储管理网络通信。又由于huawei-csi-node服务是以DaemonSet部署的，在集群中每个节点都会部署一个huawei-csi-node服务，这样部署模型导致了在大规模集群下，每个huawei-csi-node服务都会向存储发起请求，可能导致存储连接数被占满，使得huawei-csi-node不能提供正常服务。 在CSI 4.x版本优化了该部署模型，将与存储建立映射操作迁移至huawei-csi-controller服务，huawei-csi-node服务不再需要和存储管理网络通信，降低了华为CSI依赖的组网复杂度，同时huawei-csi-controller服务以Deployment形式部署，副本数根据客户可靠性要求设置，一般情况下，副本数为1~3。所以极大的减少了华为CSI与存储的连接数量，使得华为CSI服务能够接入大规模集群。 该架构变化可能会导致一个问题：升级后，使用2.x或3.x发放的工作负载，升级CSI至4.x版本之后，如果产生了一次新的挂载流程，并且CO（Container Orchestration system）未调用华为CSI提供的huawei-csi-controller服务，会导致挂载失败。问题请参考创建Pod失败，Events日志显示“publishInfo doesn&amp;rsquo;t exist”。&#xA;备份存储后端配置 如果您已按照以上须知评估风险后，确认需要从2.x或3.x版本的CSI升级至4.5.0版本，请按照以下操作步骤备份存储后端配置：&#xA;使用远程访问工具（以PuTTY为例），通过管理IP地址，登录Kubernetes集群的任意master节点。&#xA;执行以下命令备份后端信息到configmap.json文件中。OpenShift平台使用oc替换kubectl命令。&#xA;kubectl get cm huawei-csi-configmap -n huawei-csi -o json &amp;gt; configmap.json 升级华为CSI 请按照升级华为CSI中的步骤进行升级。&#xA;配置存储后端 请将备份存储后端配置中备份的后端信息，按照管理存储后端章节的说明配置存储后端，存储后端配置成功后，请务必按照以上须知所述的风险处理方法进行操作，避免Pod在漂移过程中出现问题。</description>
    </item>
    <item>
      <title>Kubernetes、OpenShift、Tanzu升级华为CSI</title>
      <link>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/kubernetes-openshift-tanzu%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/kubernetes-openshift-tanzu%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/</guid>
      <description>前提条件 旧版本华为CSI使用Helm安装。 新版本华为CSI镜像已制作完成，并且按照上传华为CSI镜像章节说明，上传到镜像仓库或者导入到所有节点。 升级华为CSI 如果您旧版本CSI使用Helm部署，请按照以下操作步骤升级华为CSI。&#xA;使用远程访问工具（以PuTTY为例），通过管理IP地址，登录Kubernetes集群的任意master节点。&#xA;将目标版本CSI组件包拷贝到master节点的任意目录下。&#xA;进入到helm/esdk的工作目录下，目录路径请参见表 软件包组件描述。&#xA;cd helm/esdk 执行kubectl apply -f ./crds/backend/命令，更新存储后端CRD&#xA;kubectl apply -f ./crds/backend/ （可选） 请务必按照检查卷快照依赖组件章节检查快照依赖组件，确认无误后执行执行kubectl apply -f ./crds/snapshot-crds/ &amp;ndash;validate=false命令更新快照CRD，如果controller.snapshot.enabled参数设置为false或Kubernetes版本低于v1.17，可跳过本步骤，详情请参考表 controller配置项说明。&#xA;kubectl apply -f ./crds/snapshot-crds/ --validate=false 执行以下命令，获取原有服务配置文件。其中helm-huawei-csi为旧版本安装时指定的Helm Chart名称，huawei-csi为旧版本安装时指定的Helm Chart命名空间。&#xA;helm get values helm-huawei-csi -n huawei-csi -a &amp;gt; ./update-values.yaml 执行vi update-values.yaml命令打开6中获取的文件，修改images配置项，更新镜像至最新版本。需要修改的参数请参考表 images配置项。&#xA;表 1 images配置项&#xA;参数&#xA;描述&#xA;修改为&#xA;images.huaweiCSIService&#xA;huawei-csi镜像。&#xA;huawei-csi:4.5.0&#xA;images.storageBackendSidecar&#xA;华为后端管理storageBackendContent资源的镜像&#xA;storage-backend-sidecar:4.5.0&#xA;images.storageBackendController&#xA;华为后端管理storageBackendClaim资源的镜像。&#xA;storage-backend-controller:4.5.0&#xA;images.huaweiCSIExtender&#xA;huawei-csi-extender镜像&#xA;huawei-csi-extender:4.5.0&#xA;images.sidecar.livenessProbe&#xA;livenessprobe sidecar镜像。&#xA;k8s.gcr.io/sig-storage/livenessprobe:v2.5.0&#xA;images.sidecar.provisioner&#xA;csi-provisioner sidecar镜像。</description>
    </item>
    <item>
      <title>CCE和CCE Agile升级华为CSI</title>
      <link>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/cce%E5%92%8Ccce-agile%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>/docs/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E4%BD%BF%E7%94%A8helm%E5%8D%87%E7%BA%A7-%E5%9B%9E%E9%80%80%E5%8D%8E%E4%B8%BAcsi/%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/cce%E5%92%8Ccce-agile%E5%8D%87%E7%BA%A7%E5%8D%8E%E4%B8%BAcsi/</guid>
      <description>前提条件 已下载新版本CSI的软件包。&#xA;操作步骤 参考CCE和CCE Agile卸载华为CSI卸载CSI。 参考CCE和CCE Agile平台安装华为CSI安装新版本的CSI。 </description>
    </item>
  </channel>
</rss>
